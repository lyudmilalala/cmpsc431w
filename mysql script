CREATE TABLE employees
        (empid int NOT NULL,
        lastName varchar(255) NOT NULL,
        firstName varchar(255) NOT NULL,
        emptype varchar(255),
        cellphone varchar(255),
        homephone varchar(255),
        ftpt varchar(10) CHECK (ftpt IN ('FT', 'PT')),
        PRIMARY KEY (empid));

LOAD DATA LOCAL INFILE '/home/grads/yus376/CS431W/cmpsc431w/datafiles/employees.csv'
        INTO TABLE employees
        FIELDS TERMINATED BY ','
        OPTIONALLY ENCLOSED BY '"'
        LINES TERMINATED BY '\r\n'
        IGNORE 1 ROWS;

UPDATE employees SET cellphone=NULL WHERE cellphone='(none)';
UPDATE employees SET homephone=NULL WHERE homephone='(none)';

CREATE TABLE departments
        (name varchar(255) NOT NULL,
        description varchar(255),
        PRIMARY KEY (name));

LOAD DATA LOCAL INFILE '/home/grads/yus376/CS431W/cmpsc431w/datafiles/departments.csv'
        INTO TABLE departments
        FIELDS TERMINATED BY ','
        OPTIONALLY ENCLOSED BY '"'
        LINES TERMINATED BY '\r\n'
        IGNORE 1 ROWS (name);

CREATE TABLE shifts
        (id int NOT NULL AUTO_INCREMENT,
        start timestamp,
        length timestamp,
        PRIMARY KEY(id));

LOAD DATA LOCAL INFILE '/home/grads/yus376/CS431W/cmpsc431w/datafiles/shifts.csv'
        INTO TABLE shifts
        FIELDS TERMINATED BY ','
        OPTIONALLY ENCLOSED BY '"'
        LINES TERMINATED BY '\r\n'
        IGNORE 1 ROWS (@FROM, @LENGTH)
        SET start = STR_TO_DATE(@FROM,'%h%p'),
            length = STR_TO_DATE(@LENGTH,'%h');

CREATE TABLE schedule
        (id int NOT NULL AUTO_INCREMENT,
        emp_id int,
        dept varchar(255),
        date TIMESTAMP,
        start TIMESTAMP,
        length TIMESTAMP,
        PRIMARY KEY(id),
        FOREIGN KEY (empid) REFERENCES employees(empid) ON DELETE CASCADE ON UPDATE CASCADE);

LOAD DATA LOCAL INFILE '/home/grads/yus376/CS431W/cmpsc431w/datafiles/schedule.csv'
        INTO TABLE shifts
        FIELDS TERMINATED BY ','
        OPTIONALLY ENCLOSED BY '"'
        LINES TERMINATED BY '\r\n'
        IGNORE 1 ROWS (@col1, emp_id, dept, @col4, @col5)
        SET date = STR_TO_DATE(@col1,'%m/%d/%Y'),
            start = STR_TO_DATE(@col4,'%h%p'),
            length = STR_TO_DATE(@col5,'%h');

CREATE TABLE employees_departments
        (emp_id int,
        dept_name varchar(255),
        FOREIGN KEY (emp_id) REFERENCES employees(empid) ON DELETE CASCADE ON UPDATE CASCADE,
        FOREIGN KEY (dept_name) REFERENCES departments(name) ON DELETE CASCADE ON UPDATE CASCADE);

CREATE TABLE rooms
        (id int NOT NULL AUTO_INCREMENT,
        floor int NOT NULL,
        room_num int NOT NULL,
        capacity int,
        worker_num int,
        PRIMARY KEY(id));

CREATE TABLE rooms_departments
        (room_id int,
        dept_name varchar(255),
        FOREIGN KEY (room_id) REFERENCES rooms(id) ON DELETE CASCADE ON UPDATE CASCADE,
        FOREIGN KEY (dept_name) REFERENCES departments(name) ON DELETE CASCADE ON UPDATE CASCADE);
