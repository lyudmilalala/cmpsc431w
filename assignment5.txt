CREATE TABLE employees
        (empid int NOT NULL,
        lastName varchar(255) NOT NULL,
        firstName varchar(255) NOT NULL,
        emptype varchar(255),
        cellphone varchar(255),
        homephone varchar(255),
        ftpt varchar(10) CHECK (ftpt IN ('FT', 'PT')),
        PRIMARY KEY (empid));

LOAD DATA LOCAL INFILE '/home/grads/yus376/CS431W/cmpsc431w/datafiles/employees.csv'
        INTO TABLE employees
        FIELDS TERMINATED BY ','
        OPTIONALLY ENCLOSED BY '"'
        LINES TERMINATED BY '\r\n'
        IGNORE 1 LINES;

UPDATE employees SET cellphone=NULL WHERE cellphone='(none)';
UPDATE employees SET homephone=NULL WHERE homephone='(none)';

CREATE TABLE departments
        (name varchar(255) NOT NULL,
        description varchar(255),
        PRIMARY KEY (name));

LOAD DATA LOCAL INFILE '/home/grads/yus376/CS431W/cmpsc431w/datafiles/departments.csv'
        INTO TABLE depdartments
        FIELDS TERMINATED BY ','
        OPTIONALLY ENCLOSED BY '"'
        LINES TERMINATED BY '\r\n'
        IGNORE 1 LINES (name);

CREATE TABLE shifts
        (id int NOT NULL AUTO_INCREMENT,
        start TIME,
        length TIME,
        PRIMARY KEY(id));

LOAD DATA LOCAL INFILE '/home/grads/yus376/CS431W/cmpsc431w/datafiles/shifts.csv'
        INTO TABLE shifts
        FIELDS TERMINATED BY ','
        OPTIONALLY ENCLOSED BY '"'
        LINES TERMINATED BY '\r\n'
        IGNORE 1 LINES (@col1, @col2)
        SET start=STR_TO_DATE(@col1,'%h%p'),
            length=STR_TO_DATE(@col2,'%H');

/*
back to strings
SELECT DATE_FORMAT(start,'%h%p') FROM shifts;
SELECT CONVERT(DATE_FORMAT(length,'%H'),UNSIGNED) FROM shifts;
*/

CREATE TABLE schedule
        (id int NOT NULL AUTO_INCREMENT,
        emp_id int,
        dept varchar(255),
        date TIMESTAMP,
        start TIME,
        length TIME,
        PRIMARY KEY(id),
        FOREIGN KEY (emp_id) REFERENCES employees(empid) ON DELETE CASCADE ON UPDATE CASCADE,
        FOREIGN KEY (dept) REFERENCES departments(name) ON DELETE CASCADE ON UPDATE CASCADE);

LOAD DATA LOCAL INFILE '/home/grads/yus376/CS431W/cmpsc431w/datafiles/schedule.csv'
        INTO TABLE schedule
        FIELDS TERMINATED BY ','
        OPTIONALLY ENCLOSED BY '"'
        LINES TERMINATED BY '\r\n'
        IGNORE 1 LINES (@col1, @col2, @col3, @col4, @col5)
        SET emp_id = @col2,
            dept = @col3,
            date=STR_TO_DATE(@col1,'%m/%d/%Y'),
            start=STR_TO_DATE(@col4,'%h%p'),
            length=STR_TO_DATE(@col5,'%H');

ALTER TABLE schedule ADD COLUMN shift_num INT;
ALTER TABLE schedule ADD CONSTRAINT FOREIGN KEY (shift_num) REFERENCES shifts(id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE schedule ADD COLUMN room INT;
